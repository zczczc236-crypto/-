<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê°•í™” ë§ˆìŠ¤í„°: ì–¼í‹°ë°‹ ëŒ€ê·œëª¨ ì—…ë°ì´íŠ¸</title>
    <style>
        :root {
            --bg: #0b0e14; --panel: #1a1f28; --accent: #4a90e2;
            --gold: #fbc531; --stone: #9c88ff; --shield: #4cd137; --fever: #e84118;
            --success: #44bd32; --danger: #c23616;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Pretendard', sans-serif; }
        body { margin: 0; background: var(--bg); color: white; display: flex; justify-content: center; height: 100vh; overflow: hidden; }
        
        .app { width: 100%; max-width: 480px; background: var(--panel); display: flex; flex-direction: column; position: relative; border-left: 1px solid #2d3436; border-right: 1px solid #2d3436; }

        /* ë¡œê·¸ì¸ ì„¹ì…˜ */
        #authSection { position: absolute; inset: 0; background: var(--bg); z-index: 1000; display: flex; flex-direction: column; justify-content: center; padding: 40px; }
        .auth-input { width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #353b48; background: #2f3640; color: white; outline: none; }
        .btn-auth { width: 100%; padding: 15px; background: var(--accent); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; }

        /* ìƒë‹¨ ë°” */
        .top-bar { display: flex; justify-content: space-around; padding: 15px; background: rgba(0,0,0,0.8); font-weight: bold; font-size: 0.85rem; }
        .user-name { position: absolute; top: 60px; left: 15px; font-size: 0.7rem; color: #7f8c8d; }

        /* ë©”ì¸ ë¬´ëŒ€ */
        .stage { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .visual-obj { font-size: 110px; z-index: 2; transition: transform 0.1s; filter: drop-shadow(0 0 15px rgba(255,255,255,0.1)); }
        .aura { position: absolute; width: 260px; height: 260px; border-radius: 50%; filter: blur(60px); opacity: 0; z-index: 1; transition: 0.6s; }

        /* ì •ë³´ì°½ */
        .info-area { text-align: center; width: 100%; padding: 0 20px; z-index: 3; }
        .lvl-badge { font-size: 2.2rem; font-weight: 800; margin: 10px 0; letter-spacing: -1px; }
        .price-tag { color: var(--gold); font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; }
        .fever-container { width: 100%; height: 6px; background: #353b48; border-radius: 3px; margin: 15px 0; overflow: hidden; }
        #feverBar { width: 0%; height: 100%; background: var(--fever); transition: 0.3s; }

        /* ì»¨íŠ¸ë¡¤ */
        .controls { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 15px; background: rgba(0,0,0,0.5); }
        button { border: none; border-radius: 12px; padding: 16px 5px; font-weight: bold; cursor: pointer; color: white; background: #2f3640; font-size: 0.85rem; }
        .btn-enhance { grid-column: span 3; background: linear-gradient(135deg, #4834d4, #686de0); font-size: 1.3rem; margin-bottom: 5px; }
        .btn-sell { background: #1b8d44; }
        button:active { transform: scale(0.96); }

        /* ìƒì  */
        #shopModal { position: absolute; inset: 0; background: rgba(11, 14, 20, 0.98); z-index: 100; display: none; flex-direction: column; padding: 25px; }
        .shop-list { flex: 1; overflow-y: auto; padding-right: 5px; }
        .shop-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #2f3640; border-radius: 12px; margin-bottom: 8px; }
        .shop-row button { padding: 10px 15px; background: var(--accent); }

        .log-box { height: 90px; background: #000; padding: 10px; font-size: 0.75rem; overflow-y: auto; color: #95a5a6; border-top: 1px solid #353b48; }
        .shake { animation: shake 0.2s ease; }
        @keyframes shake { 0%, 100% { transform: translate(0,0); } 25% { transform: translate(-8px,0); } 75% { transform: translate(8px,0); } }
    </style>
</head>
<body>

<div class="app">
    <div id="authSection">
        <h1 style="text-align:center; color:var(--accent);">ê°•í™” ë§ˆìŠ¤í„°</h1>
        <p style="text-align:center; color:#7f8c8d; font-size:0.9rem;">ê³„ì •ì„ ìƒì„±í•˜ê±°ë‚˜ ë¡œê·¸ì¸í•˜ì„¸ìš”.</p>
        <input type="text" id="username" class="auth-input" placeholder="ì•„ì´ë””">
        <input type="password" id="password" class="auth-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
        <button class="btn-auth" onclick="handleAuth()">ê²Œì„ ì‹œì‘</button>
    </div>

    <div class="top-bar">
        <span>ğŸ’° <span id="gold">0</span></span>
        <span>ğŸ’ <span id="stone">0</span></span>
        <span>ğŸ›¡ï¸ <span id="shield">0</span></span>
    </div>
    <div class="user-name" id="userDisplayName">ì‚¬ìš©ì: -</div>

    <div class="stage" id="stage">
        <div id="aura" class="aura"></div>
        <div id="visual" class="visual-obj">âš”ï¸</div>
        <div class="info-area">
            <div id="lvlName" class="lvl-badge">ê²€ +0</div>
            <div class="price-tag">ì˜ˆìƒ íŒë§¤ê°€: <span id="sellPrice">0</span>G</div>
            <div id="chanceInfo" style="color:#7f8c8d; font-size: 0.85rem;">í™•ë¥ : 100% | ë¹„ìš©: 100G</div>
            <div class="fever-container"><div id="feverBar"></div></div>
        </div>
    </div>

    <div class="controls">
        <button class="btn-enhance" onclick="handleEnhance()">ê°• í™” ì‹œ ë„</button>
        <button class="btn-sell" onclick="handleSell()">ì•„ì´í…œ íŒë§¤</button>
        <button onclick="toggleShop(true)">ğŸ›’ ìƒì </button>
        <button id="btnAuto" onclick="toggleAuto()">ìë™: OFF</button>
    </div>

    <div class="log-box" id="logBox">ë¡œì»¬ ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.</div>

    <div id="shopModal">
        <h2 style="text-align:center; color:var(--gold);">ë°±í™”ì </h2>
        <div class="shop-list">
            <div class="shop-row"><span>ğŸ›¡ï¸ íŒŒê´´ ë°©ì§€ê¶Œ (15,000G)</span><button onclick="buy('shield', 15000)">êµ¬ë§¤</button></div>
            <div class="shop-row"><span>ğŸ’ ê°•í™”ì„ x5 (500G)</span><button onclick="buy('stone', 500)">êµ¬ë§¤</button></div>
            <h3 style="margin-top:20px; color:var(--accent);">í”„ë¦¬ë¯¸ì—„ ìŠ¤í‚¨</h3>
            <div id="skinContainer"></div>
        </div>
        <button onclick="toggleShop(false)" style="background:var(--danger); padding:15px; border-radius:10px; margin-top:10px;">ìƒì  ë‚˜ê°€ê¸°</button>
    </div>
</div>

<script>
    let currentUser = null;
    let state = { gold: 1000, stone: 10, shield: 0, level: 0, fever: 0, isFever: false, auto: false, skinId: 'default', ownedSkins: ['default'] };

    const skins = [
        { id: 'default', icon: 'âš”ï¸', name: 'ë…¹ìŠ¨ ê²€', price: 0 },
        { id: 'wood', icon: 'ğŸªµ', name: 'ë‹¨ë‹¨í•œ ëª©ì¬', price: 2000 },
        { id: 'dog', icon: 'ğŸ¶', name: 'ì‹œë°”ê²¬', price: 5000 },
        { id: 'cat', icon: 'ğŸ±', name: 'ì¹˜ì¦ˆ ê³ ì–‘ì´', price: 8000 },
        { id: 'ship', icon: 'ğŸš€', name: 'íƒì‚¬ìš© ë¡œì¼“', price: 20000 },
        { id: 'alien', icon: 'ğŸ‘½', name: 'ì™¸ê³„ ì¹œêµ¬', price: 35000 },
        { id: 'ghost', icon: 'ğŸ‘»', name: 'ê¼¬ë§ˆ ìœ ë ¹', price: 50000 },
        { id: 'crown', icon: 'ğŸ‘‘', name: 'ì™•ì˜ ì™•ê´€', price: 80000 },
        { id: 'dragon', icon: 'ğŸ²', name: 'ê°€ë””ì–¸ ë“œë˜ê³¤', price: 150000 },
        { id: 'gem', icon: 'ğŸ’', name: 'ë¬´í•œì˜ ë³´ì„', price: 300000 }
    ];

    // 1. ë¡œê·¸ì¸ ì‹œìŠ¤í…œ
    function handleAuth() {
        const id = document.getElementById('username').value;
        const pw = document.getElementById('password').value;
        if(!id || !pw) return alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

        const users = JSON.parse(localStorage.getItem('users') || '{}');
        if(users[id]) {
            if(users[id].pw !== pw) return alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
            state = users[id].state;
        } else {
            users[id] = { pw: pw, state: state };
            localStorage.setItem('users', JSON.stringify(users));
            alert("íšŒì›ê°€ì… ì™„ë£Œ! í™˜ì˜í•©ë‹ˆë‹¤.");
        }
        currentUser = id;
        document.getElementById('authSection').style.display = 'none';
        document.getElementById('userDisplayName').innerText = `ì‚¬ìš©ì: ${id}`;
        updateUI();
    }

    function saveGame() {
        if(!currentUser) return;
        const users = JSON.parse(localStorage.getItem('users'));
        users[currentUser].state = state;
        localStorage.setItem('users', JSON.stringify(users));
    }

    // 2. í•µì‹¬ ê°•í™” ë¡œì§
    function handleEnhance() {
        const cost = 100 + (state.level * 350);
        if(state.gold < cost || state.stone < 1) { 
            addLog("ê³¨ë“œë‚˜ ê°•í™”ì„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!"); 
            state.auto = false; updateUI(); return; 
        }

        state.gold -= cost; state.stone--;
        let prob = Math.max(1, 100 - (state.level * 9));
        if(state.isFever) prob = Math.min(100, prob * 2);

        if(Math.random() * 100 <= prob) {
            state.level++;
            state.fever = Math.min(100, state.fever + 10);
            addLog(`ê°•í™” ì„±ê³µ! (+${state.level})`, "var(--success)");
            if(state.fever >= 100 && !state.isFever) startFever();
        } else {
            document.getElementById('stage').classList.add('shake');
            setTimeout(() => document.getElementById('stage').classList.remove('shake'), 200);
            if(state.level >= 7) {
                if(state.shield > 0) { state.shield--; addLog("ë°©ì§€ê¶Œ ì‚¬ìš©! íŒŒê´´ ëª¨ë©´.", "var(--accent)"); }
                else { state.level = 0; state.auto = false; addLog("ì•„ì´í…œ íŒŒê´´!", "var(--danger)"); }
            } else { addLog("ê°•í™” ì‹¤íŒ¨!"); }
        }
        updateUI(); saveGame();
    }

    // 3. íŒë§¤ ë°¸ëŸ°ìŠ¤ (ê°•í™”ë¹„ ëŒ€ë¹„ ì•½ 1.3ë°°ì˜ ëˆ„ì  ê°€ì¹˜)
    function handleSell() {
        if(state.level === 0) return;
        const sellPrice = Math.floor(300 * Math.pow(1.85, state.level));
        state.gold += sellPrice;
        addLog(`${state.level}ê°• íŒë§¤: +${sellPrice.toLocaleString()}G`, "var(--gold)");
        state.level = 0; updateUI(); saveGame();
    }

    function updateUI() {
        document.getElementById('gold').innerText = Math.floor(state.gold).toLocaleString();
        document.getElementById('stone').innerText = state.stone;
        document.getElementById('shield').innerText = state.shield;
        
        const skin = skins.find(s => s.id === state.skinId);
        document.getElementById('visual').innerText = skin.icon;
        document.getElementById('lvlName').innerText = `${skin.name} +${state.level}`;
        
        const cost = 100 + (state.level * 350);
        const prob = Math.max(1, 100 - (state.level * 9)) * (state.isFever ? 2 : 1);
        const sellPrice = state.level === 0 ? 0 : Math.floor(300 * Math.pow(1.85, state.level));
        
        document.getElementById('sellPrice').innerText = sellPrice.toLocaleString();
        document.getElementById('chanceInfo').innerText = `í™•ë¥ : ${Math.min(100, prob)}% | ê°•í™”ë¹„ìš©: ${cost}G`;
        document.getElementById('feverBar').style.width = `${state.fever}%`;
        document.getElementById('btnAuto').innerText = `ìë™: ${state.auto ? 'ON' : 'OFF'}`;

        const aura = document.getElementById('aura');
        if(state.level >= 15) { aura.style.opacity = 0.8; aura.style.background = "#ff4757"; }
        else if(state.level >= 10) { aura.style.opacity = 0.6; aura.style.background = "#f1c40f"; }
        else if(state.level >= 5) { aura.style.opacity = 0.4; aura.style.background = "#58a6ff"; }
        else { aura.style.opacity = 0; }
    }

    // 4. ìƒì  ë° ìë™í™”
    function buy(type, price) {
        if(state.gold < price) return addLog("ê³¨ë“œ ë¶€ì¡±!");
        state.gold -= price;
        if(type === 'stone') state.stone += 5;
        else state.shield += 1;
        updateUI(); saveGame();
    }

    function toggleShop(show) {
        const m = document.getElementById('shopModal');
        m.style.display = show ? 'flex' : 'none';
        if(show) {
            const cont = document.getElementById('skinContainer');
            cont.innerHTML = skins.map(s => `
                <div class="shop-row">
                    <span style="font-size:0.9rem;">${s.icon} ${s.name} (${s.price.toLocaleString()}G)</span>
                    <button onclick="buySkin('${s.id}')">${state.ownedSkins.includes(s.id) ? 'ì¥ì°©' : 'êµ¬ë§¤'}</button>
                </div>
            `).join('');
        }
    }

    function buySkin(id) {
        const s = skins.find(x => x.id === id);
        if(state.ownedSkins.includes(id)) { state.skinId = id; }
        else {
            if(state.gold < s.price) return addLog("ê³¨ë“œ ë¶€ì¡±!");
            state.gold -= s.price; state.ownedSkins.push(id); state.skinId = id;
        }
        toggleShop(false); updateUI(); saveGame();
    }

    function toggleAuto() {
        state.auto = !state.auto; updateUI();
        if(state.auto) autoLoop();
    }
    function autoLoop() { if(state.auto) { handleEnhance(); setTimeout(autoLoop, 1000); } }

    function startFever() {
        state.isFever = true; addLog("ğŸ”¥ í”¼ë²„ íƒ€ì„!", "var(--fever)");
        setTimeout(() => { state.isFever = false; state.fever = 0; updateUI(); }, 10000);
    }

    function addLog(m, c) {
        const log = document.getElementById('logBox');
        log.innerHTML = `<div style="color:${c || '#95a5a6'}">> ${m}</div>` + log.innerHTML;
    }

    setInterval(() => { state.gold += (2 + state.level); saveGame(); updateUI(); }, 2000);
</script>
</body>
</html>
