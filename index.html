<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê°•í™” ë§ˆìŠ¤í„°: ë¦¬ë§ˆìŠ¤í„° (ë°¸ëŸ°ìŠ¤ íŒ¨ì¹˜)</title>
    <style>
        :root {
            --bg: #0d1117; --panel: #161b22; --accent: #58a6ff;
            --gold: #f1c40f; --stone: #a29bfe; --shield: #55efc4; --fever: #ff4757;
            --success: #2ecc71; --danger: #e74c3c;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; background: var(--bg); color: white; font-family: 'Apple SD Gothic Neo', sans-serif;
            display: flex; justify-content: center; height: 100vh; overflow: hidden;
        }
        .app {
            width: 100%; max-width: 480px; background: var(--panel);
            display: flex; flex-direction: column; position: relative; border: 1px solid #30363d;
        }

        /* ë¦¬ì†ŒìŠ¤ë°” */
        .top-bar {
            display: flex; justify-content: space-around; padding: 15px;
            background: rgba(0,0,0,0.8); font-weight: bold; font-size: 0.9rem;
        }

        /* ë©”ì¸ ë¬´ëŒ€ */
        .stage {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; overflow: hidden;
        }
        .visual-obj { font-size: 100px; z-index: 2; transition: transform 0.1s; }
        .aura { position: absolute; width: 250px; height: 250px; border-radius: 50%; filter: blur(60px); opacity: 0; z-index: 1; transition: 0.5s; }

        /* ì •ë³´ì°½ */
        .info-area { text-align: center; width: 100%; padding: 0 20px; z-index: 3; }
        .lvl-badge { font-size: 2rem; font-weight: bold; margin: 10px 0; color: white; }
        .price-tag { color: var(--success); font-weight: bold; font-size: 1.1rem; margin-bottom: 10px; }
        
        .fever-container { width: 100%; height: 8px; background: #30363d; border-radius: 4px; margin: 15px 0; overflow: hidden; }
        #feverBar { width: 0%; height: 100%; background: var(--fever); transition: 0.3s; }

        /* ì»¨íŠ¸ë¡¤ */
        .controls {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 15px;
            background: rgba(0,0,0,0.5); border-top: 1px solid #30363d;
        }
        button {
            border: none; border-radius: 12px; padding: 15px 5px; font-weight: bold;
            cursor: pointer; color: white; background: #21262d; font-size: 0.9rem;
        }
        .btn-enhance { grid-column: span 3; background: var(--accent); font-size: 1.4rem; padding: 20px; margin-bottom: 5px; }
        .btn-sell { background: #238636; }
        button:active { transform: scale(0.96); }

        /* ìƒì  ëª¨ë‹¬ */
        #shopModal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(13, 17, 23, 0.98); z-index: 100; display: none; flex-direction: column; padding: 30px;
        }
        .shop-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #21262d; border-radius: 12px; margin-bottom: 10px; }

        .log-box { height: 100px; background: #000; padding: 10px; font-size: 0.8rem; overflow-y: auto; color: #8b949e; border-top: 1px solid #30363d; }
        .shake { animation: shake 0.2s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translate(0,0); } 25% { transform: translate(-5px,0); } 75% { transform: translate(5px,0); } }
    </style>
</head>
<body>

<div class="app">
    <div class="top-bar">
        <span>ğŸ’° <span id="gold">1000</span></span>
        <span>ğŸ’ <span id="stone">10</span></span>
        <span>ğŸ›¡ï¸ <span id="shield">0</span></span>
    </div>

    <div class="stage" id="stage">
        <div id="aura" class="aura"></div>
        <div id="visual" class="visual-obj">âš”ï¸</div>
        <div class="info-area">
            <div id="lvlName" class="lvl-badge">ê²€ +0</div>
            <div class="price-tag">í˜„ì¬ íŒë§¤ê°€: <span id="sellPrice">0</span>G</div>
            <div id="chanceInfo" style="color:#8b949e; font-size: 0.9rem;">í™•ë¥ : 100% | ë¹„ìš©: 100G</div>
            <div class="fever-container"><div id="feverBar"></div></div>
        </div>
    </div>

    <div class="controls">
        <button id="enhanceBtn" class="btn-enhance" onclick="handleEnhance()">ê°• í™” ì‹œ ë„</button>
        <button class="btn-sell" onclick="handleSell()">ì•„ì´í…œ íŒë§¤</button>
        <button onclick="toggleShop(true)">ğŸ›’ ìƒì </button>
        <button id="btnAuto" onclick="toggleAuto()">ìë™: OFF</button>
    </div>

    <div class="log-box" id="logBox">ì•ˆì •ì ì¸ ëŒ€ì¥ê°„ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</div>

    <div id="shopModal">
        <h2 style="text-align:center; color:var(--gold);">ê°•í™” ìƒì </h2>
        <div style="flex:1; overflow-y:auto;">
            <div class="shop-row"><span>ğŸ›¡ï¸ íŒŒê´´ ë°©ì§€ê¶Œ (2000G)</span><button onclick="buy('shield', 2000)">êµ¬ë§¤</button></div>
            <div class="shop-row"><span>ğŸ’ ê°•í™”ì„ x5 (500G)</span><button onclick="buy('stone', 500)">êµ¬ë§¤</button></div>
            <div id="skinContainer"></div>
        </div>
        <button onclick="toggleShop(false)" style="background:var(--danger); width:100%; padding:15px; margin-top:10px; border-radius:10px;">ë‹«ê¸°</button>
    </div>
</div>

<audio id="sndSuccess" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<audio id="sndFail" src="https://actions.google.com/sounds/v1/water/splash.ogg"></audio>

<script>
    let state = {
        gold: 1000, stone: 10, shield: 0, level: 0,
        fever: 0, isFever: false, auto: false,
        skin: { id: 'default', icon: 'âš”ï¸', name: 'ê²€' },
        ownedSkins: ['default']
    };

    const skins = [
        { id: 'default', icon: 'âš”ï¸', name: 'ê¸°ë³¸ ê²€', price: 0 },
        { id: 'dog', icon: 'ğŸ¶', name: 'ê°•ì•„ì§€', price: 3000 },
        { id: 'ship', icon: 'ğŸš€', name: 'ìš°ì£¼ì„ ', price: 10000 },
        { id: 'dragon', icon: 'ğŸ²', name: 'ë“œë˜ê³¤', price: 30000 }
    ];

    function updateUI() {
        document.getElementById('gold').innerText = Math.floor(state.gold).toLocaleString();
        document.getElementById('stone').innerText = state.stone;
        document.getElementById('shield').innerText = state.shield;
        document.getElementById('visual').innerText = state.skin.icon;
        
        // í™•ë¥  ê³„ì‚°
        let prob = Math.max(1, 100 - (state.level * 8));
        if (state.isFever) prob = Math.min(100, prob * 2);
        
        // ë¹„ìš© ë° íŒë§¤ê°€ ê³„ì‚° (ëŒ€í­ ìƒí–¥ëœ ê³µì‹)
        const cost = 100 + (state.level * 250);
        const sellPrice = state.level === 0 ? 0 : Math.floor(200 * Math.pow(2.1, state.level));
        
        document.getElementById('lvlName').innerText = `${state.skin.name} +${state.level}`;
        document.getElementById('sellPrice').innerText = sellPrice.toLocaleString();
        document.getElementById('chanceInfo').innerText = `ì„±ê³µ í™•ë¥ : ${prob}% | ê°•í™”ë¹„ìš©: ${cost}G`;
        document.getElementById('feverBar').style.width = `${state.fever}%`;

        // ì•„ìš°ë¼ íš¨ê³¼
        const aura = document.getElementById('aura');
        if (state.level >= 10) { aura.style.opacity = 0.7; aura.style.background = "gold"; }
        else if (state.level >= 5) { aura.style.opacity = 0.5; aura.style.background = "#58a6ff"; }
        else { aura.style.opacity = 0; }
    }

    function handleEnhance() {
        const cost = 100 + (state.level * 250);
        if (state.gold < cost || state.stone < 1) { 
            addLog("ì¬ë£Œ ë˜ëŠ” ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!", "orange"); 
            state.auto = false; 
            updateUI();
            return; 
        }

        state.gold -= cost; state.stone--;
        
        let prob = Math.max(1, 100 - (state.level * 8));
        if (state.isFever) prob = Math.min(100, prob * 2);

        if (Math.random() * 100 <= prob) {
            state.level++;
            state.fever = Math.min(100, state.fever + 10);
            document.getElementById('sndSuccess').play().catch(()=>{});
            addLog(`ê°•í™” ì„±ê³µ! (+${state.level})`, "var(--success)");
            if (state.fever >= 100 && !state.isFever) startFever();
        } else {
            document.getElementById('sndFail').play().catch(()=>{});
            document.getElementById('stage').classList.add('shake');
            setTimeout(() => document.getElementById('stage').classList.remove('shake'), 200);
            
            if (state.level >= 7) {
                if (state.shield > 0) {
                    state.shield--;
                    addLog("ì‹¤íŒ¨! ë°©ì§€ê¶Œìœ¼ë¡œ íŒŒê´´ë¥¼ ë©´í–ˆìŠµë‹ˆë‹¤.", "var(--accent)");
                } else {
                    state.level = 0; // íŒŒê´´!
                    addLog("ê°•í™” ì‹¤íŒ¨ë¡œ ì•„ì´í…œì´ íŒŒê´´ë˜ì—ˆìŠµë‹ˆë‹¤!", "var(--danger)");
                    state.auto = false;
                    document.getElementById('btnAuto').innerText = "ìë™: OFF";
                }
            } else {
                addLog("ê°•í™” ì‹¤íŒ¨! ë‹¤í–‰íˆ íŒŒê´´ë˜ì§€ëŠ” ì•Šì•˜ìŠµë‹ˆë‹¤.");
            }
        }
        updateUI();
    }

    function handleSell() {
        if (state.level === 0) {
            addLog("0ê°• ì•„ì´í…œì€ íŒ” ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }
        const sellPrice = Math.floor(200 * Math.pow(2.1, state.level));
        state.gold += sellPrice;
        addLog(`${state.level}ê°• íŒë§¤ ì™„ë£Œ! +${sellPrice.toLocaleString()}G íšë“`, "var(--gold)");
        state.level = 0;
        updateUI();
    }

    function startFever() {
        state.isFever = true;
        document.getElementById('stage').style.background = "radial-gradient(circle, #441111 0%, #0d1117 100%)";
        addLog("ğŸ”¥ FEVER TIME! ê°•í™” ì„±ê³µ í™•ë¥ ì´ 2ë°°ê°€ ë©ë‹ˆë‹¤!", "var(--fever)");
        setTimeout(() => {
            state.isFever = false; state.fever = 0;
            document.getElementById('stage').style.background = "transparent";
            updateUI();
        }, 10000);
    }

    function buy(type, price) {
        if (state.gold < price) { addLog("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."); return; }
        state.gold -= price;
        if (type === 'stone') state.stone += 5;
        else state.shield += 1;
        updateUI();
    }

    function toggleShop(show) {
        const m = document.getElementById('shopModal');
        m.style.display = show ? 'flex' : 'none';
        if (show) {
            const cont = document.getElementById('skinContainer');
            cont.innerHTML = skins.map(s => `
                <div class="shop-row">
                    <span>${s.icon} ${s.name} (${s.price.toLocaleString()}G)</span>
                    <button onclick="buySkin('${s.id}')">${state.ownedSkins.includes(s.id) ? 'ì¥ì°©' : 'êµ¬ë§¤'}</button>
                </div>
            `).join('');
        }
    }

    function buySkin(id) {
        const s = skins.find(x => x.id === id);
        if (state.ownedSkins.includes(id)) {
            state.skin = s; addLog(`${s.name} ì¥ì°© ì™„ë£Œ!`);
        } else {
            if (state.gold < s.price) { addLog("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."); return; }
            state.gold -= s.price; state.ownedSkins.push(id); state.skin = s;
            addLog(`${s.name} êµ¬ë§¤ ë° ì¥ì°© ì™„ë£Œ!`);
        }
        toggleShop(false); updateUI();
    }

    function toggleAuto() {
        state.auto = !state.auto;
        document.getElementById('btnAuto').innerText = `ìë™: ${state.auto ? 'ON' : 'OFF'}`;
        if (state.auto) autoLoop();
    }

    function autoLoop() {
        if (state.auto) { 
            handleEnhance(); 
            setTimeout(autoLoop, 1000); 
        }
    }

    function addLog(m, c) {
        const log = document.getElementById('logBox');
        log.innerHTML = `<div style="color:${c || '#8b949e'}">> ${m}</div>` + log.innerHTML;
    }

    // ê³¨ë“œ ìë™ ìˆ˜ê¸‰
    setInterval(() => { state.gold += (5 + state.level * 2); updateUI(); }, 1000);
    updateUI();
</script>
</body>
</html>
