<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê°•í™” ë§ˆìŠ¤í„°: ì–¼í‹°ë°‹ ì˜¬ì¸ì›</title>
    <style>
        :root {
            --bg: #0d1117; --panel: #161b22; --accent: #58a6ff;
            --gold: #f1c40f; --stone: #a29bfe; --shield: #55efc4; --fever: #ff4757;
            --success: #2ecc71; --danger: #e74c3c;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; background: var(--bg); color: white; font-family: 'Pretendard', sans-serif;
            display: flex; justify-content: center; height: 100vh; overflow: hidden;
        }
        .app {
            width: 100%; max-width: 480px; background: var(--panel);
            display: flex; flex-direction: column; position: relative; border: 1px solid #30363d;
        }

        /* 1. ìƒë‹¨ ìì› ë°” */
        .top-bar {
            display: flex; justify-content: space-around; padding: 15px;
            background: rgba(0,0,0,0.6); font-weight: bold; font-size: 0.9rem;
        }
        .res { display: flex; align-items: center; gap: 4px; }

        /* 2. ë©”ì¸ ì „ì‹œ êµ¬ì—­ */
        .stage {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; transition: background 0.5s;
        }
        .aura {
            position: absolute; width: 220px; height: 220px; border-radius: 50%;
            filter: blur(50px); opacity: 0; transition: 0.5s; z-index: 1;
        }
        .visual-obj {
            font-size: 100px; z-index: 2; transition: transform 0.1s, filter 0.3s;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.2));
        }

        /* 3. í”¼ë²„ & ì •ë³´ ë ˆì´ì•„ì›ƒ */
        .info-area { text-align: center; z-index: 3; width: 100%; padding: 0 20px; }
        .fever-container { width: 100%; height: 8px; background: #30363d; border-radius: 4px; margin: 15px 0; overflow: hidden; }
        #feverBar { width: 0%; height: 100%; background: var(--fever); transition: 0.3s; box-shadow: 0 0 15px var(--fever); }
        .lvl-badge { font-size: 1.8rem; font-weight: 900; margin: 10px 0; color: white; }

        /* 4. ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ì˜ì—­ */
        .controls {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 15px;
            background: rgba(0,0,0,0.4); border-top: 1px solid #30363d;
        }
        button {
            border: none; border-radius: 12px; padding: 14px 5px; font-weight: bold;
            cursor: pointer; color: white; background: #21262d; transition: 0.1s; font-size: 0.9rem;
        }
        .btn-enhance { grid-column: span 3; background: linear-gradient(45deg, #007bff, #58a6ff); font-size: 1.4rem; padding: 20px; margin-bottom: 5px; }
        .btn-shop { background: #30363d; }
        .btn-sell { background: #238636; }
        button:active { transform: scale(0.96); opacity: 0.8; }
        button:disabled { opacity: 0.4; cursor: not-allowed; }

        /* 5. ìƒì  ëª¨ë‹¬ */
        #shopModal {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 75%;
            background: #161b22; border-radius: 24px 24px 0 0; border-top: 3px solid var(--accent);
            z-index: 100; display: none; padding: 25px; overflow-y: auto;
        }
        .shop-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; background: #21262d; border-radius: 12px; margin-bottom: 10px;
        }

        /* 6. ë¡œê·¸ ì‹œìŠ¤í…œ */
        .log-box { height: 90px; background: #000; padding: 10px; font-size: 0.8rem; overflow-y: auto; color: #8b949e; border-top: 1px solid #30363d; }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        .shake { animation: shakeEffect 0.2s ease-in-out; }
        @keyframes shakeEffect { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-3px, -2px); } 100% { transform: translate(0,0); } }
        .fever-mode { background: radial-gradient(circle, #2d1616 0%, #0d1117 100%) !important; }
        .fever-active-btn { animation: pulse 0.6s infinite; background: var(--fever) !important; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="app" id="mainApp">
    <div class="top-bar">
        <div class="res">ğŸ’° <span id="gold">1000</span></div>
        <div class="res">ğŸ’ <span id="stone">10</span></div>
        <div class="res">ğŸ›¡ï¸ <span id="shield">0</span></div>
    </div>

    <div class="stage" id="stage">
        <div id="aura" class="aura"></div>
        <div id="visual" class="visual-obj">âš”ï¸</div>
        <div class="info-area">
            <div id="lvlName" class="lvl-badge">ê²€ +0</div>
            <div id="chanceInfo" style="color: #8b949e;">í™•ë¥ : 100% | ë¹„ìš©: 100G</div>
            <div class="fever-container"><div id="feverBar"></div></div>
        </div>
    </div>

    <div class="controls">
        <button id="btnEnhance" class="btn-enhance" onclick="handleEnhance()">ê°• í™” ì‹œ ë„</button>
        <button class="btn-sell" onclick="handleSell()">ì•„ì´í…œ íŒë§¤</button>
        <button class="btn-shop" onclick="toggleShop(true)">ğŸ›’ ìƒì </button>
        <button id="btnAuto" onclick="toggleAuto()">ìë™: OFF</button>
    </div>

    <div class="log-box" id="logBox">ëŒ€ì¥ê°„ì— ì–´ì„œì˜¤ì„¸ìš”! ëª¨ë“  ì¥ë¹„ë¥¼ ìµœê³  ë‹¨ê³„ë¡œ ë§Œë“œì„¸ìš”.</div>

    <div id="shopModal">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h2 style="margin:0;">ì¢…í•© ìƒì </h2>
            <button onclick="toggleShop(false)" style="background:var(--danger); padding:5px 15px;">ë‹«ê¸°</button>
        </div>
        <div class="shop-row"><span>ğŸ›¡ï¸ íŒŒê´´ ë°©ì§€ê¶Œ (2,000G)</span><button onclick="buyItem('shield', 2000)">êµ¬ë§¤</button></div>
        <div class="shop-row"><span>ğŸ’ ê°•í™”ì„ x5 (500G)</span><button onclick="buyItem('stone', 500)">êµ¬ë§¤</button></div>
        <h3 style="color:var(--accent); margin-top:20px;">ìŠ¤í‚¨ ë³€ê²½</h3>
        <div id="skinList">
            </div>
    </div>
</div>

<audio id="sdSuccess"><source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg"></audio>
<audio id="sdFail"><source src="https://actions.google.com/sounds/v1/water/splash.ogg" type="audio/ogg"></audio>

<script>
    // 1. ê²Œì„ ìƒíƒœ ë°ì´í„°
    let state = {
        gold: 1000, stone: 10, shield: 0, level: 0,
        fever: 0, isFever: false, auto: false,
        currentSkin: { id: 'default', icon: 'âš”ï¸', name: 'ê²€' },
        ownedSkins: ['default']
    };

    const skins = [
        { id: 'default', icon: 'âš”ï¸', name: 'í‰ë²”í•œ ê²€', price: 0 },
        { id: 'dog', icon: 'ğŸ¶', name: 'ìš©ë§¹í•œ ê°•ì•„ì§€', price: 5000 },
        { id: 'ship', icon: 'ğŸš€', name: 'ì°¨ì› ìš°ì£¼ì„ ', price: 15000 },
        { id: 'dragon', icon: 'ğŸ²', name: 'ê³ ëŒ€ ë“œë˜ê³¤', price: 50000 }
    ];

    // 2. ì´ˆê¸°í™” ë° ìƒì  ì„¸íŒ…
    function initShop() {
        const list = document.getElementById('skinList');
        list.innerHTML = skins.map(s => `
            <div class="shop-row">
                <span>${s.icon} ${s.name} (${s.price}G)</span>
                <button onclick="handleSkin('${s.id}')" id="skinBtn-${s.id}">${state.ownedSkins.includes(s.id) ? 'ì¥ì°©' : 'êµ¬ë§¤'}</button>
            </div>
        `).join('');
    }

    // 3. UI ì—…ë°ì´íŠ¸
    function updateUI() {
        document.getElementById('gold').innerText = Math.floor(state.gold).toLocaleString();
        document.getElementById('stone').innerText = state.stone;
        document.getElementById('shield').innerText = state.shield;
        document.getElementById('visual').innerText = state.currentSkin.icon;
        
        let prob = Math.max(1, 100 - (state.level * 8));
        if (state.isFever) prob = Math.min(100, prob * 2);
        
        const cost = 100 + (state.level * 200);
        document.getElementById('lvlName').innerText = `${state.currentSkin.name} +${state.level}`;
        document.getElementById('chanceInfo').innerText = `ì„±ê³µ í™•ë¥ : ${prob}% | ë¹„ìš©: ${cost}G`;
        document.getElementById('feverBar').style.width = `${state.fever}%`;

        // ì•„ìš°ë¼ ì—°ì¶œ
        const aura = document.getElementById('aura');
        if (state.level >= 15) { aura.style.opacity = 0.8; aura.style.background = "#ff4757"; }
        else if (state.level >= 10) { aura.style.opacity = 0.6; aura.style.background = "#f1c40f"; }
        else if (state.level >= 5) { aura.style.opacity = 0.4; aura.style.background = "#58a6ff"; }
        else { aura.style.opacity = 0; }

        const btn = document.getElementById('btnEnhance');
        if (state.isFever) btn.classList.add('fever-active-btn');
        else btn.classList.remove('fever-active-btn');
    }

    // 4. í•µì‹¬ ê¸°ëŠ¥: ê°•í™”
    function handleEnhance() {
        const cost = 100 + (state.level * 200);
        if (state.gold < cost || state.stone < 1) {
            addLog("ì¬ë£Œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!", var(--danger));
            state.auto = false; return;
        }

        state.gold -= cost; state.stone--;
        
        let prob = Math.max(1, 100 - (state.level * 8));
        if (state.isFever) prob = Math.min(100, prob * 2);

        if (Math.random() * 100 <= prob) {
            state.level++;
            state.fever = Math.min(100, state.fever + 5);
            document.getElementById('sdSuccess').play();
            addLog(`ê°•í™” ì„±ê³µ! (+${state.level})`, "var(--success)");
            if (state.fever >= 100 && !state.isFever) startFever();
        } else {
            document.getElementById('sdFail').play();
            document.getElementById('stage').classList.add('shake');
            setTimeout(() => document.getElementById('stage').classList.remove('shake'), 200);

            if (state.level >= 7) {
                if (state.shield > 0) {
                    state.shield--;
                    addLog("ì‹¤íŒ¨! ë°©ì§€ê¶Œìœ¼ë¡œ íŒŒê´´ë¥¼ ë§‰ì•˜ìŠµë‹ˆë‹¤.", "var(--accent)");
                } else {
                    state.level = 0;
                    addLog("ì‹¤íŒ¨! ì•„ì´í…œì´ íŒŒê´´ë˜ì—ˆìŠµë‹ˆë‹¤.", "var(--danger)");
                    state.auto = false;
                }
            } else {
                addLog("ê°•í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        }
        updateUI();
    }

    // 5. í”¼ë²„ íƒ€ì„
    function startFever() {
        state.isFever = true;
        document.getElementById('stage').classList.add('fever-mode');
        addLog("ğŸ”¥ FEVER TIME! í™•ë¥  2ë°° ì¦ê°€!", "var(--fever)");
        setTimeout(() => {
            state.isFever = false; state.fever = 0;
            document.getElementById('stage').classList.remove('fever-mode');
            updateUI();
        }, 10000);
    }

    // 6. íŒë§¤ ë° êµ¬ë§¤
    function handleSell() {
        if (state.level === 0) return;
        const price = Math.floor(100 * Math.pow(1.8, state.level));
        state.gold += price;
        addLog(`${state.level}ê°• íŒë§¤! +${price}G íšë“.`);
        state.level = 0; updateUI();
    }

    function buyItem(type, price) {
        if (state.gold < price) { addLog("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."); return; }
        state.gold -= price;
        if (type === 'stone') state.stone += 5;
        else state.shield += 1;
        updateUI();
    }

    function handleSkin(id) {
        const target = skins.find(s => s.id === id);
        if (state.ownedSkins.includes(id)) {
            state.currentSkin = target;
            addLog(`${target.name} ìŠ¤í‚¨ì„ ì¥ì°©í–ˆìŠµë‹ˆë‹¤.`);
        } else {
            if (state.gold < target.price) { addLog("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."); return; }
            state.gold -= target.price;
            state.ownedSkins.push(id);
            state.currentSkin = target;
            addLog(`${target.name} ìŠ¤í‚¨ì„ êµ¬ë§¤ ë° ì¥ì°©!`);
            initShop();
        }
        toggleShop(false); updateUI();
    }

    // 7. ê¸°íƒ€ í¸ì˜ ê¸°ëŠ¥
    function toggleShop(show) { document.getElementById('shopModal').style.display = show ? 'block' : 'none'; }
    function toggleAuto() { 
        state.auto = !state.auto; 
        document.getElementById('btnAuto').innerText = `ìë™: ${state.auto ? 'ON' : 'OFF'}`;
        if (state.auto) autoLoop();
    }
    function autoLoop() {
        if (state.auto) { handleEnhance(); setTimeout(autoLoop, 1000); }
    }
    function addLog(msg, color) {
        const log = document.getElementById('logBox');
        log.innerHTML = `<div style="color:${color || '#8b949e'}">> ${msg}</div>` + log.innerHTML;
    }

    // ê³¨ë“œ ìë™ ìƒì„± ë° ì´ˆê¸°í™”
    setInterval(() => { state.gold += 5 + state.level; updateUI(); }, 1000);
    initShop(); updateUI();
</script>
</body>
</html>            padding: 40px 20px; background: radial-gradient(circle, #1f4068 0%, #16213e 100%);
            border-radius: 15px; margin-bottom: 20px; position: relative;
            transition: transform 0.1s;
        }

        .item-name { font-size: 1.8rem; margin: 10px 0; color: var(--primary); font-weight: 800; }
        .item-stat { font-size: 0.9rem; color: #95a5a6; }

        /* í™•ë¥  ë° ë¹„ìš© ì •ë³´ */
        .info-panel { margin-bottom: 20px; font-size: 0.95rem; }
        .cost-text { color: #bdc3c7; }

        /* ë²„íŠ¼ ë° ì•¡ì…˜ */
        button {
            width: 100%; padding: 18px; border: none; border-radius: 10px;
            font-size: 1.2rem; font-weight: bold; cursor: pointer;
            background: linear-gradient(to bottom, var(--secondary), #d35400);
            color: white; box-shadow: 0 5px 0 #a04000; transition: 0.1s;
        }

        button:active { transform: translateY(4px); box-shadow: 0 1px 0 #a04000; }
        button:disabled { background: #7f8c8d; box-shadow: 0 5px 0 #2c3e50; opacity: 0.6; }

        /* ë¡œê·¸ */
        .log-container {
            height: 120px; overflow-y: auto; background: #1a1a2e;
            margin-top: 20px; border-radius: 8px; padding: 10px;
            font-size: 0.85rem; text-align: left; border: 1px solid #0f3460;
        }

        /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            20% { transform: translate(-3px, 0px) rotate(-1deg); }
            40% { transform: translate(3px, 2px) rotate(1deg); }
            100% { transform: translate(1px, -1px) rotate(0deg); }
        }
        .shake { animation: shake 0.3s linear; }
    </style>
</head>
<body>

<div class="game-wrapper">
    <div class="resource-bar">
        <span>ğŸ’° <span id="gold">1000</span></span>
        <span>ğŸ’ <span id="stone">5</span></span>
    </div>

    <div id="itemCard" class="item-card">
        <div class="item-stat" id="rarity">COMMON</div>
        <div class="item-name" id="itemName">ë¹›ë°”ëœ ì—°ìŠµìš© ê²€ (+0)</div>
        <div class="item-stat" id="damage">ê³µê²©ë ¥: 10</div>
    </div>

    <div class="info-panel">
        <div>ì„±ê³µ í™•ë¥ : <span id="prob">100</span>%</div>
        <div class="cost-text">í•„ìš” ë¹„ìš©: <span id="costGold">100</span>G, <span id="costStone">1</span>ğŸ’</div>
    </div>

    <button id="enhanceBtn" onclick="tryEnhance()">ê°•í™” ì‹œë„</button>

    <div class="log-container" id="gameLog">
        <div>ëŒ€ì¥ì¥ì´ê°€ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.</div>
    </div>
</div>

<script>
    // ê²Œì„ ë°ì´í„°
    let state = {
        level: 0,
        gold: 1000,
        stone: 10,
        baseDamage: 10
    };

    // ì‚¬ìš´ë“œ ê°ì²´ (ë¸Œë¼ìš°ì € ì •ì±…ìƒ ì²« í´ë¦­ í›„ í™œì„±í™”)
    const sounds = {
        success: new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg'),
        fail: new Audio('https://actions.google.com/sounds/v1/water/big_splash.ogg'),
        break: new Audio('https://actions.google.com/sounds/v1/impact/metal_clutter.ogg')
    };

    // ìë™ ìˆ˜ê¸‰ ì‹œìŠ¤í…œ (ì¬ë¯¸ë¥¼ ìœ„í•´)
    setInterval(() => {
        state.gold += 5;
        state.stone += (Math.random() > 0.9) ? 1 : 0;
        updateUI();
    }, 2000);

    function getProb(lvl) {
        if (lvl < 3) return 100;
        if (lvl < 7) return 80 - (lvl * 5);
        if (lvl < 10) return 40 - (lvl * 2);
        return 5;
    }

    function getCosts(lvl) {
        return {
            gold: 100 + (lvl * 150),
            stone: 1 + Math.floor(lvl / 5)
        };
    }

    function tryEnhance() {
        const costs = getCosts(state.level);
        if (state.gold < costs.gold || state.stone < costs.stone) {
            addLog("ì¬ë£Œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
            return;
        }

        // ë¹„ìš© ì°¨ê°
        state.gold -= costs.gold;
        state.stone -= costs.stone;

        const roll = Math.random() * 100;
        const prob = getProb(state.level);
        const card = document.getElementById('itemCard');

        if (roll <= prob) {
            // ì„±ê³µ
            state.level++;
            sounds.success.play();
            addLog(`<span style="color:#2ecc71">ê°•í™” ì„±ê³µ! (+${state.level})</span>`);
            animateCard('shake');
        } else {
            // ì‹¤íŒ¨ ë¡œì§
            if (state.level >= 10) { // 10ê°•ë¶€í„° íŒŒê´´ ìœ„í—˜
                if (Math.random() < 0.3) {
                    state.level = 0;
                    sounds.break.play();
                    addLog(`<span style="color:#e74c3c">ì•—! ì•„ì´í…œì´ íŒŒê´´ë˜ì—ˆìŠµë‹ˆë‹¤! (+0ë¶€í„° ì¬ì‹œì‘)</span>`);
                } else {
                    state.level = Math.max(0, state.level - 1);
                    sounds.fail.play();
                    addLog("ì‹¤íŒ¨ë¡œ ê°•í™” ìˆ˜ì¹˜ê°€ í•˜ë½í–ˆìŠµë‹ˆë‹¤.");
                }
            } else {
                sounds.fail.play();
                addLog("ê°•í™”ì— ì‹¤íŒ¨í–ˆì§€ë§Œ ë‹¤í–‰íˆ ë³€í™”ëŠ” ì—†ìŠµë‹ˆë‹¤.");
            }
        }
        updateUI();
    }

    function updateUI() {
        document.getElementById('gold').innerText = Math.floor(state.gold);
        document.getElementById('stone').innerText = state.stone;
        
        const costs = getCosts(state.level);
        document.getElementById('costGold').innerText = costs.gold;
        document.getElementById('costStone').innerText = costs.stone;
        
        document.getElementById('prob').innerText = getProb(state.level);
        
        const itemName = state.level >= 10 ? "ğŸ”¥ ì „ì„¤ì˜ ë“œë˜ê³¤ ìŠ¬ë ˆì´ì–´" : "ë¹›ë°”ëœ ì—°ìŠµìš© ê²€";
        document.getElementById('itemName').innerText = `${itemName} (+${state.level})`;
        document.getElementById('damage').innerText = `ê³µê²©ë ¥: ${state.baseDamage + (state.level * 15)}`;
        
        const rarity = state.level < 5 ? "COMMON" : state.level < 10 ? "RARE" : "LEGENDARY";
        document.getElementById('rarity').innerText = rarity;
        document.getElementById('rarity').style.color = rarity === "LEGENDARY" ? "#f1c40f" : "#95a5a6";
    }

    function addLog(msg) {
        const log = document.getElementById('gameLog');
        const div = document.createElement('div');
        div.innerHTML = `> ${msg}`;
        log.prepend(div);
    }

    function animateCard(className) {
        const card = document.getElementById('itemCard');
        card.classList.add(className);
        setTimeout(() => card.classList.remove(className), 300);
    }
</script>

</body>
</html>
